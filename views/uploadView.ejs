<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Upload - MyDrive</title>
    <link rel="stylesheet" href="/styles.css">
</head>
<body>
    <%- include('./partials/sidebar', { headerTitle: "Upload", folders: folders || []}) %>
    <main class="content">
        <div class="content-header">
            <%- include('./partials/header', { headerTitle: "Upload File", user: user || {} }) %>
        </div>
        
        <div class="form-container">
            <form action="/file" method="post" enctype="multipart/form-data" class="auth-form">
                <div class="form-group">
                    <label for="file">Select file to upload:</label>
                    <div class="file-input-container">
                        <input type="file" name="file" id="file" required />
                    </div>
                </div>
                
                <div class="form-group">
                    <div class="folder-select-header">
                        <label for="folder">Select destination folder:</label>
                        <a href="/folder/create" class="create-folder-link">Create new folder</a>
                    </div>
                    <select name="folder" id="folder" class="form-select">
                        <option value="">Root Directory</option>
                        <% folders.forEach(folder => { %>
                            <option value="<%= JSON.stringify(folder) %>"><%= folder.name %></option>
                        <% }); %>
                    </select>
                </div>
                <div class="form-group">
                    <label for="use-encryption">
                        <input type="checkbox" id="use-encryption" name="useEncryption" />
                        Encrypt file before upload
                    </label>
                </div>
                <div class="form-group" id="encryption-key-group" style="display: block;">
                    <label for="encryption-key">Encryption Key (leave blank to auto-generate):</label>
                    <input type="text" id="encryption-key" autocomplete="off" />
                    <!-- no name attribute so it won't reach the backend ever -->
                </div>
                <div id="encryption-warning" class="notice warning" style="display: none; margin-bottom: 1em; color: #b85c00; background: #fffbe6; padding: 0.75em 1em; border-radius: 4px;">
                    <strong>Warning:</strong> Encrypted files can only be accessed using the provided encryption key. If you lose the key, you will permanently lose access to the file.
                </div>
                <div id="key-info"></div>
                <button id="copy-key-btn" type="button" class="auth-button" style="display:none;">Copy Key</button>
                <div class="form-actions">
                    <button type="submit" class="auth-button">Upload File</button>
                    <a href="/" class="btn-secondary">Cancel</a>
                </div>
            </form>
        </div>
    </main>

    <script type="module" src="/js/encryptFile.js"></script>
</body>
</html>
