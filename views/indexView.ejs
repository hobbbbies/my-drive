<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyDrive</title>
    <link rel="stylesheet" href="/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
</head>
<body>
    <%- include('partials/sidebar', { headerTitle: headerTitle, folders : rootFolders || []}) %>
    <main class="content">
        <div class="content-header">
            <%- include('partials/header', { user: user }) %>
        </div>
        
        <div class="files-container">
            <!-- Future implentation: path will be rendered here -->
                <div class="files-grid">
                    <%if (locals.nestedFolders){ %>
                        <% nestedFolders.forEach((folder) => { %>
                            <div class="folder-item" onclick="window.location.href='/root/<%= folder.id %>'">
                                <div class="file-icon">ðŸ“‚</div>
                                <div class="file-name"><%= folder.name %></div>
                                <button class="delete-folder" onclick="event.stopPropagation(); deleteFolder('<%= folder.id %>')">
                                    <i class="fas fa-trash"></i>
                                </button>
                                <button class="share-folder" onclick="event.stopPropagation(); openShareModal('<%= folder.id %>', '<%= folder.name %>', 'folder')">
                                    <i class="fas fa-share-alt"></i>
                                </button>
                            </div>
                        <% })%>
                    <% }%>
                    <% if (locals.files) { %>
                        <% files.forEach((file) => { %>
                            <div class="file-item" 
                            data-filename="<%= file.name %>"
                            data-size="<%= file.size %> b"
                            data-ext="<%= file.extension %>"
                            data-added="<%= file.createdAt %>"
                            data-folderid="<%= file.folderid %>"
                            data-storagePath="<%= file.storagePath %>"
                            >
                                <div class="file-icon">ðŸ“„</div>
                                <div class="file-name"><%= file.name %></div>
                            </div>
                        <% }); %>
                    <% } %>
                    <% if (locals.sharedFiles) { %>
                        <% sharedFiles.forEach((sharedFile) => { %>
                            <div class="file-item shared-file" 
                            data-filename="<%= sharedFile.name %>"
                            data-size="<%= sharedFile.size %> b"
                            data-ext="<%= sharedFile.extension %>"
                            data-added="<%= sharedFile.createdAt %>"
                            data-folderid="<%= sharedFile.folderid %>"
                            data-storagePath="<%= sharedFile.storagePath %>"
                            >
                                <div class="file-icon">ðŸ“„</div>
                                <div class="file-name"><%= sharedFile.name %></div>
                                <span class="shared-indicator">Shared by <%= sharedFile.User.email %></span>
                            </div>
                        <% }); %>
                    <% } %>
                </div>
                <% if ((!files || !files.length) && (!nestedFolders || !nestedFolders.length)) { %>
                    <div class="empty-state">
                        <p>No files yet. Start by uploading a file!</p>
                    </div>
                <% } %>
        </div>
    </main>

    <!-- File Details Modal -->
    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="modal-title">File name</h2>
                <a class="close" href="#">Ã—</a>
            </div>
            <div class="modal-body">
                <div class="file-details">
                    <div class="detail-item">
                        <span class="detail-label">Size:</span>
                        <span id="modal-size" class="detail-value">--</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Type:</span>
                        <span id="modal-ext" class="detail-value">--</span>
                    </div>
                    <div class="detail-item">
                        <span class="detail-label">Added:</span>
                        <span id="modal-added" class="detail-value">--</span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <a id="download-link" class="modal-button primary" href="#">Download</a>
                <button id="share-link" class="modal-button secondary" onclick="shareFromModal()">Share</button>
                <a id="delete-link" class="modal-button danger" href="#">Delete</a>
            </div>
        </div>
    </div>

    <!-- Include Share Modal -->
    <%- include('partials/shareModal') %>
    
    <!-- Include JavaScript files -->
    <script src="/js/shareModal.js"></script>
    <script src="/js/index.js"></script>
</body>
</html>